<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Master X | Crash</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>body{background:#000;color:white;}</style>
</head>
<body class="p-4">
    <div class="flex justify-between p-3 bg-zinc-900 rounded-xl mb-4">
        <a href="./index.html">ğŸ”™</a>
        <span id="balance">0</span> ğŸª™
    </div>

    <div class="text-center p-10 bg-zinc-900 rounded-2xl mb-4">
        <div id="counter" class="text-5xl font-black">1.00x</div>
    </div>

    <input type="number" id="bet-amount" placeholder="Ø§Ù„Ù…Ø¨Ù„Øº" class="w-full p-4 rounded-xl bg-zinc-900 mb-3 text-center">
    <button id="play-btn" onclick="startCrash()" class="w-full bg-red-600 p-4 rounded-xl font-bold">Ø¨Ø¯Ø¡ ğŸš€</button>
    <button id="cashout-btn" onclick="cashOut()" class="w-full bg-green-600 p-4 rounded-xl font-bold hidden">ÙƒØ§Ø´ Ø£ÙˆØª! ğŸ’°</button>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/12.9.0/firebase-app.js";
        import { getDatabase, ref, update, get, onValue } from "https://www.gstatic.com/firebasejs/12.9.0/firebase-database.js";

        const db = getDatabase(initializeApp({
            apiKey: "AIzaSyCd6mOpEJyiUSAAhmm2NbhT80MMY0UQJcc",
            databaseURL: "https://project-fe025bb5-b1cc-4b8f-93e-default-rtdb.firebaseio.com"
        }));
        
        const phone = localStorage.getItem('zeykor_phone');
        let currentMultiplier = 1.0, isPlaying = false, interval, userLuck = 50;

        // Ø¬Ù„Ø¨ Ø§Ù„Ø­Ø¸ Ù…Ù† Ø§Ù„Ø£Ø¯Ù…Ù†
        onValue(ref(db, 'ZEYKOR/config/luck/crash'), snap => { userLuck = snap.val() || 50; });
        onValue(ref(db, 'ZEYKOR/users/' + phone), snap => { document.getElementById('balance').innerText = snap.val()?.balance || 0; });

        window.startCrash = () => {
            let bet = parseInt(document.getElementById('bet-amount').value);
            if(isNaN(bet) || bet <= 0) return alert("Ø­Ø¯Ø¯ Ù…Ø¨Ù„Øº!");
            
            get(ref(db, 'ZEYKOR/users/' + phone)).then(snap => {
                if(bet > (snap.val()?.balance || 0)) return alert("Ø±ØµÙŠØ¯ ØºÙŠØ± ÙƒØ§ÙÙŠ!");
                update(ref(db, 'ZEYKOR/users/' + phone), { balance: snap.val().balance - bet });
                
                isPlaying = true;
                currentMultiplier = 1.0;
                
                // ğŸ’¡ Ù…Ø¹Ø§Ø¯Ù„Ø© Ø§Ù„Ø­Ø¸ (Ø¥Ø°Ø§ Ø§Ù„Ø­Ø¸ Ù…Ù†Ø®ÙØ¶ØŒ Ø§Ù„Ø§Ù†ÙØ¬Ø§Ø± ÙŠÙƒÙˆÙ† Ø³Ø±ÙŠØ¹)
                let maxCrash = 1.0 + (userLuck / 10); 
                let crashPoint = (Math.random() * maxCrash) + 1.0;
                
                document.getElementById('play-btn').classList.add('hidden');
                document.getElementById('cashout-btn').classList.remove('hidden');

                interval = setInterval(() => {
                    currentMultiplier += 0.05;
                    document.getElementById('counter').innerText = currentMultiplier.toFixed(2) + "x";
                    if (currentMultiplier >= crashPoint) {
                        clearInterval(interval);
                        document.getElementById('counter').innerText = "ğŸ’¥ Ø§Ù†ÙØ¬Ø±Øª!";
                        isPlaying = false;
                        setTimeout(resetGame, 2000);
                    }
                }, 100);
            });
        };

        window.cashOut = () => {
            if(!isPlaying) return;
            clearInterval(interval);
            let bet = parseInt(document.getElementById('bet-amount').value);
            let profit = Math.floor(bet * currentMultiplier);
            get(ref(db, 'ZEYKOR/users/' + phone)).then(snap => {
                update(ref(db, 'ZEYKOR/users/' + phone), { balance: snap.val().balance + profit });
                document.getElementById('counter').innerText = "ÙÙˆØ²: " + profit + " ğŸª™";
                isPlaying = false;
                setTimeout(resetGame, 2000);
            });
        };

        function resetGame() {
            document.getElementById('play-btn').classList.remove('hidden');
            document.getElementById('cashout-btn').classList.add('hidden');
            document.getElementById('counter').innerText = "1.00x";
        }
    </script>
</body>
</html>
