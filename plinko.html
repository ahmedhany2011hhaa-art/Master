<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Master X | Plinko</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>body{background:#000;color:white;}</style>
</head>
<body class="p-4">
    <div class="flex justify-between p-3 bg-zinc-900 rounded-xl mb-4">
        <a href="./index.html">ðŸ”™</a>
        <span id="balance">0</span> ðŸª™
    </div>

    <div class="text-center p-10 bg-zinc-900 rounded-2xl mb-4 h-64">
        <div id="result" class="text-3xl font-black mt-10">ðŸŽ°</div>
    </div>

    <input type="number" id="bet-amount" placeholder="Ø§Ù„Ù…Ø¨Ù„Øº" class="w-full p-4 rounded-xl bg-zinc-900 mb-3 text-center">
    <button onclick="dropBall()" class="w-full bg-red-600 p-4 rounded-xl font-bold">Ø¥Ø³Ù‚Ø§Ø· Ø§Ù„ÙƒØ±Ø© ðŸ”´</button>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/12.9.0/firebase-app.js";
        import { getDatabase, ref, update, get, onValue } from "https://www.gstatic.com/firebasejs/12.9.0/firebase-database.js";

        const db = getDatabase(initializeApp({
            apiKey: "AIzaSyCd6mOpEJyiUSAAhmm2NbhT80MMY0UQJcc",
            databaseURL: "https://project-fe025bb5-b1cc-4b8f-93e-default-rtdb.firebaseio.com"
        }));
        
        const phone = localStorage.getItem('zeykor_phone');
        let userLuck = 50;
        onValue(ref(db, 'ZEYKOR/config/luck/plinko'), snap => { userLuck = snap.val() || 50; });
        onValue(ref(db, 'ZEYKOR/users/' + phone), snap => { document.getElementById('balance').innerText = snap.val()?.balance || 0; });

        window.dropBall = () => {
            let bet = parseInt(document.getElementById('bet-amount').value);
            if(isNaN(bet) || bet <= 0) return alert("Ø­Ø¯Ø¯ Ù…Ø¨Ù„Øº!");
            
            get(ref(db, 'ZEYKOR/users/' + phone)).then(snap => {
                if(bet > (snap.val()?.balance || 0)) return alert("Ø±ØµÙŠØ¯ ØºÙŠØ± ÙƒØ§ÙÙŠ!");
                update(ref(db, 'ZEYKOR/users/' + phone), { balance: snap.val().balance - bet });

                document.getElementById('result').innerText = "ðŸ”´";
                
                setTimeout(() => {
                    // ðŸ’¡ Ù…Ø¹Ø§Ø¯Ù„Ø© Ø§Ù„Ø­Ø¸: ØªØ¹ØªÙ…Ø¯ Ø¹Ù„Ù‰ Ù†Ø³Ø¨Ø© Ø§Ù„Ø­Ø¸ Ù…Ù† Ø§Ù„Ø£Ø¯Ù…Ù†
                    let multipliers = [0, 0.2, 0.5, 1, 1.5, 2, 5];
                    
                    // Ø¥Ø°Ø§ ÙƒØ§Ù† Ø§Ù„Ø­Ø¸ Ø¹Ø§Ù„ÙŠØ§Ù‹ØŒ Ù†Ø²ÙŠØ¯ Ø§Ø­ØªÙ…Ø§Ù„ÙŠØ© Ø§Ù„Ø£Ø±Ù‚Ø§Ù… Ø§Ù„ÙƒØ¨ÙŠØ±Ø©
                    if(userLuck > 70) multipliers = [0.5, 1, 1.5, 2, 5, 10];
                    if(userLuck < 30) multipliers = [0, 0, 0.1, 0.5, 1];

                    let m = multipliers[Math.floor(Math.random() * multipliers.length)];
                    let profit = Math.floor(bet * m);
                    
                    get(ref(db, 'ZEYKOR/users/' + phone)).then(userSnap => {
                        update(ref(db, 'ZEYKOR/users/' + phone), { balance: userSnap.val().balance + profit });
                        document.getElementById('result').innerText = m + "x (" + profit + "ðŸª™)";
                    });
                }, 1500);
            });
        };
    </script>
</body>
</html>
